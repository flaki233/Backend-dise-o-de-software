-- ============================================
-- BASE TRUEQUE - PostgreSQL
-- ============================================

DROP TABLE IF EXISTS imagen_oferta CASCADE;
DROP TABLE IF EXISTS oferta CASCADE;
DROP TABLE IF EXISTS estado_oferta CASCADE;
DROP TABLE IF EXISTS categoria_oferta CASCADE;

-- ============================================
-- TABLA: categoria_oferta
-- ============================================

CREATE TABLE categoria_oferta (
    categoria_oferta_id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    categoria_oferta_nombre VARCHAR(55) NOT NULL,
    usuario_creacion VARCHAR(45) NOT NULL,
    fecha_creacion TIMESTAMP NOT NULL,
    usuario_modificacion VARCHAR(45),
    fecha_modificacion TIMESTAMP,
    estado_registro SMALLINT NOT NULL
);

INSERT INTO categoria_oferta (categoria_oferta_id, categoria_oferta_nombre, usuario_creacion, fecha_creacion, usuario_modificacion, fecha_modificacion, estado_registro)
OVERRIDING SYSTEM VALUE VALUES
(3,'ELECTRÓNICOS','admin','2025-11-03 16:33:09','admin','2025-11-03 17:04:43',0),
(4,'ELECTRÓNICOS','admin','2025-11-03 16:33:11',NULL,NULL,1),
(5,'VERDURAS','admin','2025-11-03 16:33:12','admin','2025-11-03 17:10:03',1),
(6,'ELECTRÓNICOS','admin','2025-11-03 16:33:14',NULL,NULL,1);

SELECT setval(pg_get_serial_sequence('categoria_oferta','categoria_oferta_id'), 6, true);

-- ============================================
-- TABLA: estado_oferta
-- ============================================

CREATE TABLE estado_oferta (
    estado_oferta_id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    estado_oferta_nombre VARCHAR(55) NOT NULL,
    usuario_creacion VARCHAR(45) NOT NULL,
    fecha_creacion TIMESTAMP NOT NULL,
    usuario_modificacion VARCHAR(45),
    fecha_modificacion TIMESTAMP,
    estado_registro SMALLINT NOT NULL
);

INSERT INTO estado_oferta (estado_oferta_id, estado_oferta_nombre, usuario_creacion, fecha_creacion, usuario_modificacion, fecha_modificacion, estado_registro)
OVERRIDING SYSTEM VALUE VALUES
(1,'BORRADOR','admin','2025-11-03 17:55:58','luis','2025-11-03 18:00:38',1);

SELECT setval(pg_get_serial_sequence('estado_oferta','estado_oferta_id'), 1, true);

-- ============================================
-- TABLA: oferta
-- ============================================

CREATE TABLE oferta (
    oferta_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    oferta_titulo VARCHAR(255) NOT NULL,
    oferta_condicion_trueque VARCHAR(255) NOT NULL,
    oferta_comentario_obligatorio VARCHAR(255) NOT NULL,
    oferta_latitud DECIMAL(11,8) NOT NULL,
    oferta_longitud DECIMAL(11,8) NOT NULL,
    categoria_oferta_id INTEGER NOT NULL REFERENCES categoria_oferta(categoria_oferta_id),
    estado_oferta_id INTEGER REFERENCES estado_oferta(estado_oferta_id),
    usuario_creacion VARCHAR(45),
    fecha_creacion TIMESTAMP,
    usuario_modificacion VARCHAR(45),
    fecha_modificacion TIMESTAMP,
    estado_registro SMALLINT
);

INSERT INTO oferta (oferta_id, oferta_titulo, oferta_condicion_trueque, oferta_comentario_obligatorio, oferta_latitud, oferta_longitud, categoria_oferta_id, estado_oferta_id, usuario_creacion, fecha_creacion, usuario_modificacion, fecha_modificacion, estado_registro)
OVERRIDING SYSTEM VALUE VALUES
(2,'Intercambio de libros de programación actualizado','Libros en excelente estado, sin páginas rotas','Disponible para intercambio toda la semana',-12.04637300,-77.04275400,4,1,'admin','2025-11-03 18:18:24','admin','2025-11-03 18:26:24',1),
(3,'Intercambio de libros de programación','Libros en buen estado, sin páginas rotas','Disponible para intercambio los fines de semana',-12.04637300,-77.04275400,4,1,'admin','2025-11-03 18:44:46',NULL,NULL,1),
(4,'Intercambio de libros de programación','Libros en buen estado, sin páginas rotas','Disponible para intercambio los fines de semana',-12.04637300,-77.04275400,4,1,'admin','2025-11-03 18:45:24',NULL,NULL,1),
(5,'Intercambio de libros de programación','Libros en buen estado, sin páginas rotas','Disponible para intercambio los fines de semana',-12.04637300,-77.04275400,4,1,'admin','2025-11-03 18:46:56',NULL,NULL,1),
(6,'Intercambio de libros de programación','Libros en buen estado, sin páginas rotas','Disponible para intercambio los fines de semana',-12.04637300,-77.04275400,4,1,'admin','2025-11-03 18:47:13',NULL,NULL,1),
(7,'Intercambio de libros de programación','Libros en buen estado, sin páginas rotas','Disponible para intercambio los fines de semana',-12.04637300,-77.04275400,4,1,'admin','2025-11-03 18:49:23',NULL,NULL,1);

SELECT setval(pg_get_serial_sequence('oferta','oferta_id'), 7, true);

-- ============================================
-- TABLA: imagen_oferta
-- ============================================

CREATE TABLE imagen_oferta (
    imagen_oferta_id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    oferta_id BIGINT NOT NULL REFERENCES oferta(oferta_id),
    imagen_oferta_nombre VARCHAR(55) NOT NULL,
    imagen_oferta_ruta VARCHAR(255),
    usuario_creacion VARCHAR(45) NOT NULL,
    fecha_creacion TIMESTAMP NOT NULL,
    usuario_modificacion VARCHAR(45),
    fecha_modificacion TIMESTAMP,
    estado_registro SMALLINT NOT NULL
);

INSERT INTO imagen_oferta (imagen_oferta_id, oferta_id, imagen_oferta_nombre, imagen_oferta_ruta, usuario_creacion, fecha_creacion, usuario_modificacion, fecha_modificacion, estado_registro)
OVERRIDING SYSTEM VALUE VALUES
(1,4,'imagen_principal','uploads/images/imagen_principal_1762213523626.jpeg','admin','2025-11-03 18:45:24',NULL,NULL,1),
(2,5,'imagen_principal','uploads/images/imagen_principal_1762213616017.jpeg','admin','2025-11-03 18:46:56',NULL,NULL,1),
(3,5,'imagen_secundaria','uploads/images/imagen_secundaria_1762213616032.jpeg','admin','2025-11-03 18:46:56',NULL,NULL,1),
(4,6,'imagen_principal','uploads/images/imagen_principal_1762213633342.jpeg','admin','2025-11-03 18:47:13',NULL,NULL,1),
(5,6,'imagen_secundaria','uploads/images/imagen_secundaria_1762213633359.jpeg','admin','2025-11-03 18:47:13',NULL,NULL,1),
(6,7,'imagen_principal','uploads/images/imagen_principal_1762213762945.jpeg','admin','2025-11-03 18:49:23',NULL,NULL,1),
(7,7,'imagen_secundaria','uploads/images/imagen_secundaria_1762213762968.jpeg','admin','2025-11-03 18:49:23',NULL,NULL,1);

SELECT setval(pg_get_serial_sequence('imagen_oferta','imagen_oferta_id'), 7, true);
